{% extends 'content/galleries_base.html' %}

{% block head %}
  {{ block.super }}
  {% load static %}
  <script src="{% static 'content/js/vendor/d3.v4.min.js' %}"></script>
  <script src="{% static 'content/js/score_bars.js' %}"></script>
{% endblock %}

{% block top_content_left %}
  {% block top_left_ad %}{{ block.super }}{% endblock %}
  <div class="col-md-4">
    <header id="gallery-description">
      <h2>
        {{ gallery_dict.gallery_title }}</h2>
      <p>
        {{ gallery_dict.description_html | safe }}</p>
    </header><!-- #gallery-description -->
  </div><!-- col-md-4 -->
{% endblock %}

{% block top_aside %}
  {{ block.super }}
{% endblock %}

{% block above_middle_row_ad %}{% endblock %}

{% block middle_left_ad %}{% endblock %}
{% block middle_content %}
  {% for image_dict in gallery_dict.image_list %}
    {% if image_dict.title == 'responsive_ad' %}
      {% block middle_content_responsive_ad %}{{ block.super }}{% endblock %}
    {% elif image_dict.title == 'large_rectangle_ad' %}
      {% block middle_content_large_rectangle_ad %}{{ block.super }}{% endblock %}
    {% elif image_dict.title == 'medium_rectangle_ad' %}
      {% block middle_content_medium_rectangle_ad %}{{ block.super }}{% endblock %}
    {% elif image_dict.title == 'square_ad' %}
      {% block middle_content_square_ad %}{{ block.super }}{% endblock %}
    {% elif image_dict.title == 'small_square_ad' %}
      {% block middle_content_small_square_ad %}{{ block.super }}{% endblock %}
    {% else %}
      <div class="col-md-4">
        <div class="gallery-image">
          <figure>
            <a href="{{ image_dict.image_link_href }}" title="{{ image_dict.image_link_title }}">
              <img src="{% static image_dict.image_file_path %}"
                   class="center gallery-image"></a>
              <figcaption><q>{{ image_dict.title }}</q></figcaption>
          </figure>
          {% if image_dict.score %}
            <div class="score-svg" id="score-bars-{{ image_dict.id }}">
            </div><!-- #score-bars-{{ image_dict.id }} -->
          {% endif %}
          {% if image_dict.subject_line %}
            <p>{{ image_dict.subject_line }}</p>
          {% endif %}
          {% if image_dict.tweet %}
            <p>{{ image_dict.tweet }}</p>
          {% endif %}
          <p>{{ image_dict.explanation }}</p>
        </div><!-- .gallery-image -->
      </div><!-- .col-md-4 -->
    {% endif %}
    {% cycle '' '' '</div><!-- .row --><div class="row">' %}
  {% endfor %}
{% endblock %}

{% block middle_right_ad %}{% endblock %}

{% block below_middle_row_ad %}{{ block.super }}{% endblock %}
{% block bottom_left_ad %}{% endblock %}
{% block bottom_content %}{% endblock %}
{% block bottom_right_ad %}{% endblock %}
{% block bottom_row_ad %}{% endblock %}

{% block footer %}
  {{ block.super }}
  {% for image_dict in gallery_dict.image_list %}
    {% if image_dict.score %}
      <script>
        //
        // Define positioning parameters and create the score_bars d3 svg chart
        //
        var positioning_params_{{ image_dict.id }} = {
          selector: '#score-bars-{{ image_dict.id }}',
          total_width: 150,
          total_height: 35,
          margin_top: 5,
          margin_right: 11,
          margin_bottom: 15,
          margin_left: 15,
        };
        var image_score_{{ image_dict.id }} = [
          {% for pair in image_dict.score %}
            {{ pair|safe }},
          {% endfor %}
        ];
        score_bars.create_chart_svg(
          positioning_params_{{ image_dict.id }},
          image_score_{{ image_dict.id }}
        );
      </script>
    {% endif %}
  {% endfor %}
{% endblock %}
