{% extends 'content/base.html' %}

{% block head %}
  {{ block.super }}
  {% load static %}
  <script src="{% static 'content/js/vendor/d3.v4.min.js' %}"></script>
  <script src="{% static 'content/js/score_bars.js' %}"></script>
 {% endblock %}

{% block top_row_ad %}{% endblock %}
{% block top_content_left %}{% endblock %}
{% block top_aside %}{% endblock %}

{% block above_middle_row_ad %}{{ block.super }}{% endblock %}
{% block middle_left_ad %}{{ block.super }}{% endblock %}

{% block middle_content %}
  <div class="col-md-8">
    <section id="image">
      <div class="single-image">
        <figure>
          <img src="{% static image_dict.path %}" class="single-img center">
          <figcaption>{{ image_dict.title }}</figcaption>
        </figure>
        <div class="text-center">
          {% if image_dict.subtitle_html %}
            <p>{{ image_dict.subtitle_html | safe }}</p>
          {% else %}
            {% if image_dict.tweet_html %}
              <p>{{ image_dict.tweet_html | safe }}</p>
            {% elif image_dict.subject_line %}
              <p>{{ image_dict.subject_line }}</p>
            {% endif %}
          {% endif %}
        </div><!-- .text-center -->
        {% if image_dict.score %}
          <div class="score-svg" id="score-bars"></div><!-- #score-bars -->
        {% else %}
          <p>{{ image_dict.four_letter_type }}</p>
        {% endif %}
        {% if image_dict.explain_dom  %}
          <div class="text-center">
            <a class="btn btn-md" id="toggle-explain-dom"
              title="Toggle explanation of how the image represents the dominant personality function">
              Explain Dominant Function</a>
          </div><!-- .text-center -->
          <p id="explain-dom" style="display:none;">
            {{ image_dict.explain_dom }}</p>
        {% endif %}
        {% if image_dict.explain_aux  %}
        <div class="text-center">
          <a class="btn btn-md" id="toggle-explain-aux"
            title="Toggle explanation of how the image represents the auxiliary personality function">
            Explain Auxiliary Function</a>
        </div><!-- .text-center -->
        <p id="explain-aux" style="display:none;">
          {{ image_dict.explain_aux }}</p>
        {% endif %}
        {% if image_dict.story_html %}
          <p>{{ image_dict.story_html | safe }}</p>
        {% endif %}
      </div><!-- .single-image -->
    </section><!-- #image -->
  </div><!-- .col-md-8 -->
{% endblock %}

{% block middle_right_ad %}{{ block.super }}{% endblock %}
{% block below_middle_row_ad %}{{ block.super }}{% endblock %}

{% block bottom_left_ad %}{% endblock %}
{% block bottom_right_ad %}{% endblock %}
{% block bottom_row_ad %}{% endblock %}

{% block footer %}
  {{ block.super }}
  {% if image_dict.explain_dom  %}
    <script>
      /*
       * Set the bootstrap classes for the colors corresponding to the type
       */
      var class_for_dom = seeourminds.bootstrap_class_for_dom["{{ image_dict.four_letter_type }}"]
      var class_for_aux = seeourminds.bootstrap_class_for_aux["{{ image_dict.four_letter_type }}"]
      $("#toggle-explain-dom").addClass(class_for_dom);
      $("#toggle-explain-aux").addClass(class_for_aux);
      /*
       * Event handler for the Explain Dominant Function button:
       */
      $("#toggle-explain-dom").click(function() {
        $("#explain-dom").slideToggle("slow");
        var button_text = $("#toggle-explain-dom").text();
        if ( button_text.includes('Explain') ) {
          $("#toggle-explain-dom").text("Hide Explanation");
        } else {
          $("#toggle-explain-dom").text("Explain Dominant Function");
        }
      });
      /*
       * Event handler for the Explain Auxiliary Function button:
       */
      $("#toggle-explain-aux").click(function() {
        $("#explain-aux").slideToggle("slow");
        var button_text = $("#toggle-explain-aux").text();
        if ( button_text.includes('Explain') ) {
          $("#toggle-explain-aux").text("Hide Explanation");
        } else {
          $("#toggle-explain-aux").text("Explain Auxiliary Function");
        }
      });
    </script>
  {% endif %}

  {% if image_dict.score %}
    <script>
      /*
       * For the Score Bars:
       * -------------------
       * Define positioning parameters and create the score_bars d3 svg chart
       */
      var positioning_params = {
        selector: '#score-bars',
        total_width: 575,
        total_height: 35,
        margin_top: 8,
        margin_right: 21,
        margin_bottom: 15,
        margin_left: 62,
      };
      var image_score = [
        {% for pair in image_dict.score %}
          {{ pair|safe }},
        {% endfor %}
      ];
      score_bars.create_chart_svg(
        positioning_params,
        image_score
      );
    </script>
  {% endif %}
{% endblock %}
